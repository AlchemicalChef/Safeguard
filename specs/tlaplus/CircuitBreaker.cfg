\* TLC Model Checking Configuration for CircuitBreaker
\* Run with: tlc CircuitBreaker.tla -config CircuitBreaker.cfg

\* ============================================================================
\* CONSTANT DEFINITIONS
\* ============================================================================

\* Matches production configuration from ResilienceConfiguration.cs
CONSTANT
    FAILURE_THRESHOLD = 5
    FAILURE_RATIO_PERCENT = 50
    SAMPLING_DURATION = 30
    BREAK_DURATION = 30
    MAX_TIME = 100

\* Smaller model for quick verification
\* CONSTANT
\*     FAILURE_THRESHOLD = 3
\*     FAILURE_RATIO_PERCENT = 50
\*     SAMPLING_DURATION = 10
\*     BREAK_DURATION = 10
\*     MAX_TIME = 50

\* ============================================================================
\* SPECIFICATION
\* ============================================================================

SPECIFICATION Spec

\* ============================================================================
\* SAFETY INVARIANTS
\* ============================================================================

\* Type correctness
INVARIANT TypeOK

\* Counters are non-negative
INVARIANT CountersNonNegative

\* Time is monotonic
INVARIANT TimeMonotonic

\* Sampling window is in the past
INVARIANT SamplingWindowInPast

\* Combined safety
INVARIANT Safety

\* ============================================================================
\* LIVENESS PROPERTIES
\* ============================================================================

\* Open circuit eventually transitions to HalfOpen
PROPERTY OpenEventuallyHalfOpen

\* HalfOpen eventually resolves
PROPERTY HalfOpenEventuallyResolves

\* Requests complete
PROPERTY RequestsComplete

\* Circuit is not stuck open forever
PROPERTY NotStuckOpen

\* ============================================================================
\* STATE CONSTRAINT
\* ============================================================================

CONSTRAINT
    /\ now <= MAX_TIME
    /\ failureCount <= FAILURE_THRESHOLD + 5
    /\ successCount <= 20
