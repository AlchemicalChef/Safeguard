\* TLC Model Checking Configuration for TokenRefresh
\* Run with: tlc TokenRefresh.tla -config TokenRefresh.cfg

\* ============================================================================
\* CONSTANT DEFINITIONS
\* ============================================================================

\* Small model - 2 threads for quick verification
CONSTANT
    THREADS = {t1, t2}
    NULL = NULL
    REFRESH_BUFFER = 5
    MAX_TIME = 20

\* Medium model - 3 threads for thorough verification
\* CONSTANT
\*     THREADS = {t1, t2, t3}
\*     NULL = NULL
\*     REFRESH_BUFFER = 5
\*     MAX_TIME = 30

\* ============================================================================
\* SPECIFICATION
\* ============================================================================

SPECIFICATION Spec

\* ============================================================================
\* SAFETY INVARIANTS - CRITICAL CONCURRENCY PROPERTIES
\* ============================================================================

\* Type correctness
INVARIANT TypeOK

\* At most one thread holds the lock
INVARIANT MutualExclusion

\* At most one thread in critical section
INVARIANT AtMostOneRefreshing

\* Lock holder state is consistent
INVARIANT LockHolderStateConsistent

\* Queue doesn't contain lock holder
INVARIANT QueueExcludesHolder

\* Queue members are waiting
INVARIANT QueueMembersWaiting

\* ============================================================================
\* LIVENESS PROPERTIES
\* ============================================================================

\* Every request eventually completes
PROPERTY RequestEventuallyCompletes

\* Waiting threads eventually acquire lock
PROPERTY WaitingEventuallyAcquires

\* ============================================================================
\* STATE CONSTRAINT
\* ============================================================================

CONSTRAINT
    /\ now <= MAX_TIME
    /\ Len(refreshLockQueue) <= Cardinality(THREADS)

\* ============================================================================
\* SYMMETRY (threads are interchangeable)
\* ============================================================================

SYMMETRY ThreadSymmetry
ThreadSymmetry == Permutations(THREADS)
